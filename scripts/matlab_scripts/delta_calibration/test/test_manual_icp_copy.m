function [q T R R1 T1 T2 dM] = test_manual_icp()
  R1 = [0.4774832092915897 -0.29196396657830775 -0.8287139597378972
  0.3659422888366805 -0.7914006352694992 0.4896644521874184
  -0.7988091299463069 -0.5370680373238513 -0.27103855297638113];
  q1 = [-0.32211955119400515
  0.79685669940358
  0.02320941842923044
  -0.5106072054430708];

  T1 = [1.14
  .61
  -2.1];
  
  q2 = [-0.32198196614427793
  0.789633984879369
  0.10838113517952123
  0.5109396372748858];

  T2 = [1.21
  -.51
  2.08];
  
  M1 = M1FromQuart(q1);
  M2 = M2FromQuart(q2);
  dM = M1 - M2;
  
  [E V] = eig(dM*dM')
  q = E(:,2);

  % Resulting quat from null space of dM:
  %  q = [-0.007490908015693267
  %  0.9961410659270169
  %  0.08744609357224277
  %  -0.00020926022392021962];
  % Which is 179.14159714380534 degrees about
  % -0.9961690156852057
  % -0.08744854713755947
  % 0.00020926609535033846
  % which is correct!
  R = [0.984706273858226 0.17421415462623768 -0.0017270066915867814
  0.1742204248225926 -0.9845941340321099 0.0148874042127841
  0.0008931958815387261 -0.014960600169271605 -0.9998876850145182];

  a = (eye(3) - R1);
  T = inv(a'*a)*a'*(T2-R*T1);

function m1 = M1FromQuart(r1)
  w = r1(1);
  x = r1(2);
  y = r1(3);
  z = r1(4);
  m1 = [w, -x, -y, -z; 
        x,  w,  z, -y;
        y, -z,  w,  x;
        z,  y, -x,  w];
  m1(isnan(m1)) = 0 ;

function m2 = M2FromQuart(r1)
  w = r1(1);
  x = r1(2);
  y = r1(3);
  z = r1(4);
  m2 = [w, -x, -y, -z; 
        x,  w, -z,  y;
        y,  z,  w, -x;
        z, -y,  x,  w];
  m2(isnan(m2)) = 0 ;


